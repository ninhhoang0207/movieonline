<?php namespace App\Http\Controllers;use App\Http\Requests;use App\Http\Controllers\Controller;use Illuminate\Http\Request;use App\Actor;use App\Country;use Validator,DB,delete;use Redirect;class ActorController extends Controller {	public function index(){		$actor= Actor::orderBy('id','decs')->get();		return view('admin.list')->with('actor',$actor);	}	public function addActor(){		$actor=Actor::all();		$countries = Country::all();		//print_r($actor);die;		return view('admin.add',['data'=>$countries]);	}	public function postActor(Request $request){		$rules= array(				"actor_name"=>"required",				"ckeditor" =>"required",				"file" =>"required",			);		$messages = array(			"actor_name.required"=>"Vui lòng nhập tên diễn viên !",			"ckeditor.required"=>"Bạn chưa nhập nội dung !",			"file.required"=>" Bạn chưa chọn ảnh "			);		$validate =Validator::make($request->all(),$rules,$messages);		if($validate->fails()){			return \Redirect::back()							->withErrors($validate)							->withInput();		}else{			$actor=DB::table('actors');			if($request->hasFile('file')){				$file=$request->file('file');				$filename = $file->getClientOriginalName();				$duoi = $file->getClientOriginalExtension();				if ($duoi!='jpg'&& $duoi!='png') {					return Redirect('/dienvien-them')->with('error','Bạn chỉ được chọn file có đuôi jpg or png');				}				$hinh = str_random(4)."_".$filename;				while (file_exists('resources/actor_imgs/'.$hinh)) {						$hinh = str_random(1000)."_".$filename;				}				$file->move('./resources/actor_imgs',$hinh);									}			else{					$hinh="";			}				$inputData = array(					'name'=>$request->actor_name,					'countries_id' =>$request->countries_id,					'about'=>$request['ckeditor'],					'image' => './resources/actor_imgs/'.$hinh,				);				if ($actor->insert($inputData)) {					return \Redirect::back()->with('message','Thêm thành công !');				}				else{					return \Redirect::back()->with('message','Có lỗi xảy ra .vui lòng thử lại  !');				}					}	}	// public function delete(Request $request){	// 	$id = $request->id;	// 	return view('admin.delete');	// }	public function destroy(Request $request){		$id = $request->id;		$actor= Actor::find($id);		$actor->delete();		return \Redirect::back()->with('message','Xoa thanh cong');	}	public function getEdit(Request $request){		$id = $request->get('id');		$countries=Country::all();		$actor = Actor::find($id);		$actors = Actor::all();		return view('admin.sua',['actor'=>$actor,'actors'=>$actors,'countries'=>$countries]);	}	public function postEdit(Request $request){		$id = $request->get('id');		$actor = Actor::find($id);		$rules= array(				"actor_name"=>"required",				"ckeditor" =>"required",				"file" =>"required",			);		$messages = array(			"actor_name.required"=>"Vui long nhap ten dien vien",			"ckeditor.required"=>"Vui long nhap noi dung",			"file.required"=>"Ban chua chon anh "			);		$validate = Validator::make($request->all(),$rules, $messages);		if ($validate ->fails()) {			return \Redirect::back()							->withErrors($validate)							->withInput();		}else{						if($request->hasFile('file')){				$file=$request->file('file');				$filename = $file->getClientOriginalName();				$duoi = $file->getClientOriginalExtension();				if ($duoi!='jpg'&& $duoi!='png') {					return Redirect('/dienvien-them')->with('error','Bạn chỉ được chọn file có đuôi jpg or png');				}				$hinh = $id."_".time();				$file->move('./resources/actor_imgs/',$hinh);				//xoa hinh cu di 				$url = './resources/actor_imgs/'.$hinh;				$actor->image = $url;								}			else{					$hinh="";			}			$actor->name = $request->actor_name;			$actor->about = $request->ckeditor;			$actor->countries_id=$request->select;			$actor->save();		}		 return \Redirect::back()->withInput()->with('responseData', array('statusCode' => 1, 'message' => 'Thành công'));	}}